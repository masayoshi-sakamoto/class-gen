<template>
  <<%= name %> :value="entities" :options="options" :title="title" @fetch="fetch" @save="save" @destroy="destroy" @update="update"></<%= name %>>
</template>

<script lang="ts">
import Vue from 'vue'
import authenticated from '@/middleware/authenticated'
import <%= name %> from '@/components/templates/<%= name %>'
import Fetch<%= names %>UseCase from '@/usecases/<%= name.toLowerCase() %>/Fetch<%= names %>UseCase'
import Save<%= name %>UseCase from '@/usecases/<%= name.toLowerCase() %>/Save<%= name %>UseCase'
import Delete<%= name %>UseCase from '@/usecases/<%= name.toLowerCase() %>/Delete<%= name %>UseCase'
import Update<%= names %>UseCase from '@/usecases/<%= name.toLowerCase() %>/Update<%= names %>UseCase'
import <%= name %>Entity from '@/entities/<%= name %>'
import OptionsEntity from '@/entities/Options'

interface IData {
  entities: <%= name %>Entity[]
  options: OptionsEntity | undefined
  title: string
}

export default Vue.extend({
  middleware: [authenticated],
  components: {
    <%= name %>
  },
  async fetch({ App }) {
    const usecase1 = new Fetch<%= names %>UseCase(App)
    await Promise.all([usecase1.execute(App.<%= name.toLowerCase() %>.options())])
  },
  data(): IData {
    return {
      entities: this.App.<%= name.toLowerCase() %>.all(),
      options: this.App.<%= name.toLowerCase() %>.options(),
      title: '<%= japanese %>'
    }
  },
  methods: {
    async fetch(entity: OptionsEntity) {
      const usecase = new Fetch<%= names %>UseCase(this.App)
      const res = await usecase.execute(entity)
      if (typeof res === 'string') {
        return this.$router.push(res)
      }
      if (res) {
        this.entities = this.App.<%= name.toLowerCase() %>.all()
        this.options = this.App.<%= name.toLowerCase() %>.options()
      }
    },
    async save(entity: <%= name %>Entity) {
      const usecase = new Save<%= name %>UseCase(this.App)
      const res = await usecase.execute(entity)
      if (typeof res === 'string') {
        return this.$router.push(res)
      }
      if (res) {
        this.entities = this.App.<%= name.toLowerCase() %>.all()
        this.App.state.setDialog('<%= name.toLowerCase() %>', false)
      }
    },
    async destroy(entity: <%= name %>Entity) {
      const usecase = new Delete<%= name %>UseCase(this.App)
      const res = await usecase.execute(entity)
      if (typeof res === 'string') {
        return this.$router.push(res)
      }
      this.entities = this.App.<%= name.toLowerCase() %>.all()
    },
    async update(entities: <%= name %>Entity[]) {
      const usecase = new Update<%= names %>UseCase(this.App)
      const res = await usecase.execute(entities)
      if (typeof res === 'string') {
        return this.$router.push(res)
      }
      this.entities = this.App.<%= name.toLowerCase() %>.all()
    }
  },
  head() {
    return {
      title: this.title
    }
  }
})
</script>
